
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Automate your lights with Tellstick and Nexa in Fedora 20 - blog.fridns.se</title>
  <meta name="author" content="Patrik Martinsson">

  
  <meta name="description" content="In this post I&rsquo;m going to describe the way I have configured my setup to
automate my bedroom-lights. In this particular setup I use the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.fridns.se/blog/2014/01/12/automate-your-lights-with-tellstick-and-nexa-in-fedora-20">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="blog.fridns.se" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">blog.fridns.se</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.fridns.se" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/portfolio">Portfolio</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Automate Your Lights With Tellstick and Nexa in Fedora 20</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-12T17:41:08+01:00" pubdate data-updated="true">Jan 12<span>th</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In this post I&rsquo;m going to describe the way I have configured my setup to
automate my bedroom-lights. In this particular setup I use the following
components,</p>

<ul>
  <li><a href="http://www.clasohlson.com/se/Inbyggnadsmottagare-universaldimmer-Nexa-WMR-252/36-5271">Nexa WMR252</a>
  <li><a href="http://www.lohelectronics.se/tellstick-p-135.html">Tellstick</a>
  <li><a href="http://www.fedoraproject.org">Fedora</a>
  <li><a href="https://github.com/p3tecracknell/tellprox/">Tellprox</a>
</ul>


<p>The goal of the setup is to automate the lights so that they can be turned
on in the morning, I imagine that if I wake up to a light instead of a buzzer
I will be in a better mood and it will be easier for me to get up. The other
goal is to be able to control the lights from my phone.</p>

<!--more-->


<p>So the first thing is obviously to attach the tellstick to your computer,
after it&rsquo;s been attached look for something like this in your <strong>dmesg</strong>,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>1199357.989893<span class="o">]</span> usb 1-1.1: new full-speed USB device number 12 using ehci-pci
</span><span class='line'><span class="o">[</span>1199358.081310<span class="o">]</span> usb 1-1.1: New USB device found, <span class="nv">idVendor</span><span class="o">=</span>1781, <span class="nv">idProduct</span><span class="o">=</span>0c30
</span><span class='line'><span class="o">[</span>1199358.081313<span class="o">]</span> usb 1-1.1: New USB device strings: <span class="nv">Mfr</span><span class="o">=</span>1, <span class="nv">Product</span><span class="o">=</span>2, <span class="nv">SerialNumber</span><span class="o">=</span>3
</span><span class='line'><span class="o">[</span>1199358.081314<span class="o">]</span> usb 1-1.1: Product: TellStick
</span><span class='line'><span class="o">[</span>1199358.081316<span class="o">]</span> usb 1-1.1: Manufacturer: Telldus
</span><span class='line'><span class="o">[</span>1199358.081317<span class="o">]</span> usb 1-1.1: SerialNumber: A7029QUB
</span><span class='line'><span class="o">[</span>1199358.128916<span class="o">]</span> usbcore: registered new interface driver ftdi_sio
</span><span class='line'><span class="o">[</span>1199358.128926<span class="o">]</span> usbserial: USB Serial support registered <span class="k">for </span>FTDI USB Serial Device
</span><span class='line'><span class="o">[</span>1199358.128991<span class="o">]</span> ftdi_sio 1-1.1:1.0: FTDI USB Serial Device converter detected
</span><span class='line'><span class="o">[</span>1199358.129009<span class="o">]</span> usb 1-1.1: Detected FT232RL
</span><span class='line'><span class="o">[</span>1199358.129010<span class="o">]</span> usb 1-1.1: Number of endpoints 2
</span><span class='line'><span class="o">[</span>1199358.129012<span class="o">]</span> usb 1-1.1: Endpoint 1 MaxPacketSize 64
</span><span class='line'><span class="o">[</span>1199358.129013<span class="o">]</span> usb 1-1.1: Endpoint 2 MaxPacketSize 64
</span><span class='line'><span class="o">[</span>1199358.129014<span class="o">]</span> usb 1-1.1: Setting MaxPacketSize 64
</span><span class='line'><span class="o">[</span>1199358.129427<span class="o">]</span> usb 1-1.1: FTDI USB Serial Device converter now attached to ttyUSB0
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s basically the kernel telling you that it has found the device you just inserted
and attached it to <strong>/dev/ttyUSB0</strong>. If you don&rsquo;t see this in your log,
then you have issues that&rsquo;s beyond the scope of this article, sorry ;)</p>

<p>Assuming that the device actually was found, we continue with downloading, building and
installing the telldus-core,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Make sure you have necessary tools/libs, </span>
</span><span class='line'>sudo yum groupinstall <span class="s2">&quot;Development Tools&quot;</span> <span class="s2">&quot;C Development Tools and Libraries&quot;</span>
</span><span class='line'>sudo yum install libconfuse-devel libftdi-devel cmake
</span><span class='line'>
</span><span class='line'><span class="c"># Download telldus-core, </span>
</span><span class='line'><span class="nb">cd</span> /tmp/
</span><span class='line'>wget http://download.telldus.se/TellStick/Software/telldus-core/telldus-core-2.1.1.tar.gz
</span><span class='line'>tar xvfp telldus-core-2.1.1.tar.gz
</span><span class='line'><span class="nb">cd </span>telldus-core-2.1.1/
</span><span class='line'>
</span><span class='line'><span class="c"># Patch Socket.h since it needs to include unistd.h,</span>
</span><span class='line'>sed -i <span class="s1">&#39;/#include &lt;string&gt;/a \#include &lt;unistd.h&gt;&#39;</span> common/Socket.h
</span><span class='line'>
</span><span class='line'><span class="c"># Build it and install the telldus-core, </span>
</span><span class='line'>cmake
</span><span class='line'>make
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>If you get any errors above while build the telldus-core, you should be able to find
the culprit by looking at the error-message, hopefully it will make some sense (or not,
you never know, however I&rsquo;ve done these exact steps on a clean install of Fedora 20 so
it would surprise me if it failed for you if you&rsquo;re in the same environment).</p>

<p>Since telldus puts its beloved libtelldus-core.so.2 under /usr/local/lib (even though it&rsquo;s
64bit in my case), you have some options</p>

<ul>
  <li> Make ldconfig pick up libs under /usr/local/lib by creating a usr-local.conf under 
  /etc/ld.so.conf.d/ with the path /usr/local/lib in it (or even better, move the libs to 
  /usr/local/lib64 and include that path instead, since it&#8217;s a 64bit system). 
  <li> Make a symbolic in /usr/lib64 that points to /usr/local/lib/libtelldus-core.so.2.1.1
</ul>


<p>Personally I took the easy way out by creating a symlink,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Create a link, </span>
</span><span class='line'>sudo ln -s /usr/lib64/libtelldus-core.so.2 /usr/local/lib/libtelldus-core.so.2.1.1
</span><span class='line'>
</span><span class='line'><span class="c"># Whichever method you prefer, make sure the lib is available, you can check it with </span>
</span><span class='line'>ldd /usr/local/bin/tdtool
</span><span class='line'>
</span><span class='line'>&gt; linux-vdso.so.1 <span class="o">=</span>&gt;  <span class="o">(</span>0x00007fffb63fe000<span class="o">)</span>
</span><span class='line'>&gt; libtelldus-core.so.2 <span class="o">=</span>&gt; /lib64/libtelldus-core.so.2 <span class="o">(</span>0x00007fd9482c2000<span class="o">)</span>
</span><span class='line'>&gt; libstdc++.so.6 <span class="o">=</span>&gt; /lib64/libstdc++.so.6 <span class="o">(</span>0x00007fd947fba000<span class="o">)</span>
</span><span class='line'>&gt; libm.so.6 <span class="o">=</span>&gt; /lib64/libm.so.6 <span class="o">(</span>0x00007fd947cb2000<span class="o">)</span>
</span><span class='line'>&gt; etc..
</span><span class='line'>
</span><span class='line'><span class="c"># If the line that says &quot;libtelldus-core.so.2&quot; does say &quot;Not found&quot;, you are doing something</span>
</span><span class='line'><span class="c"># wrong. Try again (you need to run sudo ldconfig, if you&#39;re choosing the first method).</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Go on with configuring the telldus-core so we can connect it to our <b>Nexa-WMR-252</b>,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Edit the config-file with your favorite editor, </span>
</span><span class='line'>sudo gvim /etc/tellstick.conf
</span><span class='line'>
</span><span class='line'><span class="c"># My config looks like this, but of course this could differ depending on your setup, </span>
</span><span class='line'><span class="c"># --- Start --- </span>
</span><span class='line'><span class="nv">user</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span>
</span><span class='line'><span class="nv">group</span> <span class="o">=</span> <span class="s2">&quot;plugdev&quot;</span>
</span><span class='line'><span class="nv">ignoreControllerConfirmation</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
</span><span class='line'><span class="nv">deviceNode</span> <span class="o">=</span> <span class="s2">&quot;/dev/ttyUSB0&quot;</span>
</span><span class='line'>device <span class="o">{</span>
</span><span class='line'>  <span class="nv">id</span> <span class="o">=</span> 1
</span><span class='line'>    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;Dimmer bedroom&quot;</span>
</span><span class='line'>    <span class="nv">protocol</span> <span class="o">=</span> <span class="s2">&quot;arctech&quot;</span>
</span><span class='line'>    <span class="nv">model</span> <span class="o">=</span> <span class="s2">&quot;selflearning-dimmer&quot;</span>
</span><span class='line'>    parameters <span class="o">{</span>
</span><span class='line'>      <span class="nv">house</span> <span class="o">=</span> <span class="s2">&quot;123456&quot;</span> <span class="c"># This is the code that the nexa-reciever will learn, </span>
</span><span class='line'>      <span class="nv">unit</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c"># --- End --- </span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now, it&rsquo;s time to get the things going,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># First step is to start the telldus-core-daemon, </span>
</span><span class='line'>sudo telldusd
</span></code></pre></td></tr></table></div></figure>


<p>Next step is to learn the nexa our &ldquo;code&rdquo;, press the little button under the
red-diode to put the Nexa-WMR-252 in &ldquo;self-learning-mode&rdquo;, then type the command below, <br><br>
<strong>Notes,</strong></p>

<ul>
  <li>The lights must be off when doing this. 
  <li>The &#8220;self-learning-mode&#8221; lasts for 12 seconds, that means you have to continue with 
      the &#8220;learning-step&#8221; (tdtool &#8211;learn 1) <strong>before</strong> the 12 seconds runs out. The red 
      diode will blink as long as the nexa is in the &#8220;self-learning-mode&#8221;. Once it receives
      the code it will dim on and off the lights. 
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># First, make sure that you have your devices configured properly, </span>
</span><span class='line'>tdtool -l
</span><span class='line'>&gt; Number of devices: 1
</span><span class='line'>&gt; 1    Dimmer bedroom  OFF
</span><span class='line'>
</span><span class='line'><span class="c"># If no devices are listed above, go back and make sure that telldusd is started </span>
</span><span class='line'><span class="c"># correctly, you can get some debug from the daemon by appending the --nodaemon-flag</span>
</span><span class='line'><span class="c"># to it. </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Use the tdtool to learn the nexadevice the code, </span>
</span><span class='line'>tdtool --learn 1
</span><span class='line'>&gt; Learning device: 1 Dimmer bedroom - Success
</span></code></pre></td></tr></table></div></figure>


<p>Awesomeness, now we can do all sorts of fun stuff,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Turn the dimmers on, </span>
</span><span class='line'>tdtool --on 1
</span><span class='line'>&gt; Turning on device 1, Dimmer bedroom - Success
</span><span class='line'>
</span><span class='line'><span class="c"># Turn the dimmers off, </span>
</span><span class='line'>tdtool --off 1
</span><span class='line'>&gt; Turning on device 1, Dimmer bedroom - Success
</span><span class='line'>
</span><span class='line'><span class="c"># Set a specific dim-level, </span>
</span><span class='line'>tdtool --dimlevel 25 --dim 1
</span><span class='line'>
</span><span class='line'><span class="c"># Why not go all the way, </span>
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>seq 10 10 250<span class="k">)</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>tdtool --dimlevel <span class="nv">$i</span> --dim 1
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>seq 250 -10 10<span class="k">)</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>tdtool --dimlevel <span class="nv">$i</span> --dim 1
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>To control my lights through my phone I use the tellprox, found <a href="https://github.com/p3tecracknell/tellprox">here</a>.
This is a local server that you can use if you don&rsquo;t want to use the
&ldquo;tellstick-live-cloud&rdquo;-thingie, which fits me perfect.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Make sure you have git installed, </span>
</span><span class='line'>sudo yum install git
</span><span class='line'>
</span><span class='line'><span class="c"># Clone the tellprox-repo, </span>
</span><span class='line'><span class="nb">cd</span> ~/bin/
</span><span class='line'>git clone https://github.com/p3tecracknell/tellprox
</span><span class='line'>
</span><span class='line'><span class="c"># Edit the configuration for our needs,</span>
</span><span class='line'>gvim config.ini
</span><span class='line'>
</span><span class='line'><span class="c"># My config looks like this, </span>
</span><span class='line'><span class="c"># --- Start --- </span>
</span><span class='line'><span class="nv">host</span> <span class="o">=</span> localhost
</span><span class='line'><span class="nv">port</span> <span class="o">=</span> 8081
</span><span class='line'><span class="nv">debug</span> <span class="o">=</span> False
</span><span class='line'><span class="nv">editable</span> <span class="o">=</span> False
</span><span class='line'><span class="nv">client_name</span> <span class="o">=</span> TellProx
</span><span class='line'><span class="nv">client_id</span> <span class="o">=</span> 1
</span><span class='line'><span class="nv">pretty_print</span> <span class="o">=</span> False
</span><span class='line'><span class="nv">timezone</span> <span class="o">=</span> Europe/London
</span><span class='line'><span class="nv">latitude</span> <span class="o">=</span> 51.4500007629
</span><span class='line'><span class="nv">longitude</span> <span class="o">=</span> -2.58330011368
</span><span class='line'><span class="nv">tzoffset</span> <span class="o">=</span> 3600
</span><span class='line'><span class="nv">webroot</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="nv">username</span> <span class="o">=</span>
</span><span class='line'><span class="nv">password</span> <span class="o">=</span>
</span><span class='line'><span class="nv">apikey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">[</span>sensors<span class="o">]</span>
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Save the config above and start the tellprox, </span>
</span><span class='line'>python -m tellprox
</span><span class='line'>
</span><span class='line'>&gt; Bottle v0.11.6 server starting up <span class="o">(</span>using CherryPyServer<span class="o">())</span>...
</span><span class='line'>&gt; Listening on http://localhost:8081/
</span><span class='line'>&gt; Hit Ctrl-C to quit.
</span><span class='line'>
</span><span class='line'><span class="c"># Note, config.ini should be in the directory from where you are starting tellprox, </span>
</span></code></pre></td></tr></table></div></figure>


<p>Open up a web browser and point it to <a href="http://localhost:8081">http://localhost:8081</a> and you should
see the &ldquo;Dimmer bedroom&rdquo;-device there.</p>

<p>Lastly I want to be able to control this from my phone, and since I don&rsquo;t
have a &ldquo;local network&rdquo; at home, I need to be able to reach it from the &ldquo;internet&rdquo;.
Since there is no basic authentication implemented yet in tellprox (or at least
I can&rsquo;t seem to get it to work, I&rsquo;ll use an apache instance with basic auth infront
of tellprox).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Install apache, </span>
</span><span class='line'>sudo yum install httpd
</span><span class='line'>
</span><span class='line'><span class="c"># Enable it, </span>
</span><span class='line'>sudo systemctl <span class="nb">enable </span>httpd
</span><span class='line'>
</span><span class='line'><span class="c"># Configure it, </span>
</span><span class='line'>sudo gvim /etc/httpd/conf.d/tellprox.conf
</span><span class='line'>
</span><span class='line'><span class="c"># My config looks like this, since we are sending passwords you should be using </span>
</span><span class='line'><span class="c"># ssl (there are tons of guides on how to generate your own self-signed-certificate), </span>
</span><span class='line'>
</span><span class='line'><span class="c"># --- Start ---</span>
</span><span class='line'>Listen xxxx.xx.xx:8082
</span><span class='line'>&lt;VirtualHost *:8082&gt;
</span><span class='line'>  SSLEngine on
</span><span class='line'>  SSLProxyEngine On
</span><span class='line'>  SSLCertificateFile  /path-your-certificate
</span><span class='line'>  SSLCertificateKeyFile /path-to-your-key
</span><span class='line'>  SSLProxyCheckPeerName off
</span><span class='line'>  SSLProxyCheckPeerCN off
</span><span class='line'>
</span><span class='line'>  &lt;Location /&gt;
</span><span class='line'>    AuthType Basic
</span><span class='line'>    AuthName <span class="s2">&quot;You&#39;re not controlling my bedroom-lights!&quot;</span>
</span><span class='line'>    AuthUserFile /etc/httpd/conf.d/passwords
</span><span class='line'>    Require user xxx
</span><span class='line'>  &lt;/Location&gt;
</span><span class='line'>
</span><span class='line'>  <span class="c"># Proxy to tellprox, </span>
</span><span class='line'>  ProxyPass / http://localhost:8081/
</span><span class='line'>  ProxyPassReverse / http://localhost:8081/
</span><span class='line'>
</span><span class='line'>  <span class="c"># Possible values include: debug, info, notice, warn, error, crit, alert, emerg.</span>
</span><span class='line'>  LogLevel info
</span><span class='line'>  ErrorLog /var/log/httpd/tellprox-error.log
</span><span class='line'>  CustomLog /var/log/httpd/tellprox-access.log combined
</span><span class='line'>&lt;/VirtualHost&gt;
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create a password for myuser, </span>
</span><span class='line'>sudo htpasswd -c /etc/httpd/conf.d/passwords myuser
</span><span class='line'>
</span><span class='line'><span class="c"># To allow us to use port 8082 we need </span>
</span><span class='line'><span class="c"># Since the port 8082 isn&#39;t a pre-configured port for a webserver, we need to manually</span>
</span><span class='line'><span class="c"># add with semanage, otherwise selinux will prevent us from listening on that particular </span>
</span><span class='line'><span class="c"># port,  </span>
</span><span class='line'>sudo semanage port -a -t http_port_t -p tcp 8082
</span><span class='line'>
</span><span class='line'><span class="c"># Start the webserver, </span>
</span><span class='line'>sudo systemctl start httpd
</span></code></pre></td></tr></table></div></figure>


<p>Lastly, we make sure that this will keep working after a reboot, and we also set up a
small crontab-job for making the lights turn on in the morning,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Since I&#39;m quite lazy, I choose the rc.local-way of starting things at boot, </span>
</span><span class='line'><span class="c"># but yes, I know, there are &quot;better&quot; (define better) ways of doing this. </span>
</span><span class='line'><span class="c"># But again, this is simple and doesn&#39;t require much, </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Enable rc.local at boot, </span>
</span><span class='line'>sudo systemctl <span class="nb">enable </span>rc-local.service
</span><span class='line'>
</span><span class='line'><span class="c"># Create a /etc/rc.d/rc.local, </span>
</span><span class='line'>sudo gvim /etc/rc.d/rc.local
</span><span class='line'>
</span><span class='line'><span class="c"># --- Start ---</span>
</span><span class='line'><span class="c">#!/bin/bash </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Start the telldus-core-daemon, </span>
</span><span class='line'>/usr/local/sbin/telldusd
</span><span class='line'>
</span><span class='line'><span class="c"># Start our tellprox, maybe not the most beutiful you have seen, bit it works for me, for now, </span>
</span><span class='line'>sudo -u myuser bash -c <span class="s2">&quot;cd /home/myuser/bin/tellprox &amp;&amp; python -m tellprox&quot;</span> &amp;
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Then make a small script, </span>
</span><span class='line'>gvim ~/bin/turnonbedroomlights.sh
</span><span class='line'>
</span><span class='line'><span class="c"># --- Start ---</span>
</span><span class='line'><span class="c">#!/bin/bash </span>
</span><span class='line'>
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>seq 10 10 250<span class="k">)</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>tdtool --dimlevel <span class="nv">$i</span> --dim 1
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Make it executable, </span>
</span><span class='line'>chmod +x ~/bin/turnonbedroomlights.sh
</span><span class='line'>
</span><span class='line'><span class="c"># Add a crontab-entry making the lights go on every morning at 6:30, </span>
</span><span class='line'>crontab -e
</span><span class='line'>
</span><span class='line'><span class="c"># Every weekday morning, </span>
</span><span class='line'>30 06 * * 1-5 /home/username/bin/turnonbedroomlights.sh
</span></code></pre></td></tr></table></div></figure>


<p>And there you have it, enjoy !<br></p>

<ul>
  <li> Automatically turn on my lights in the morning. 
  <li> Control them from my phone 
</ul>


<p>Comments, suggestions and questions are welcome!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Patrik Martinsson</span></span>

      








  


<time datetime="2014-01-12T17:41:08+01:00" pubdate data-updated="true">Jan 12<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/automation/'>automation</a>, <a class='category' href='/blog/categories/fedora/'>fedora</a>, <a class='category' href='/blog/categories/nexa/'>nexa</a>, <a class='category' href='/blog/categories/tellstick/'>tellstick</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/08/08/smplayer-subtitles-errror/" title="Previous Post: smplayer subtitles errror">&laquo; smplayer subtitles errror</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/12/automate-your-lights-with-tellstick-and-nexa-in-fedora-20/">Automate your lights with Tellstick and Nexa in Fedora 20</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/08/08/smplayer-subtitles-errror/">smplayer subtitles errror</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/30/spotify-in-red-hat-6/">Spotify in Red Hat 6</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/27/disable-sound-in-gdm-ubuntu-11-04/">Disable sound in gdm - Ubuntu 11.04</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/21/ubuntu-classic-flash-fullscreen/">Ubuntu Classic - Flash fullscreen</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/patchon">@patchon</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'patchon',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/martinsson.patrik@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Patrik Martinsson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fridns';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.fridns.se/blog/2014/01/12/automate-your-lights-with-tellstick-and-nexa-in-fedora-20/';
        var disqus_url = 'http://blog.fridns.se/blog/2014/01/12/automate-your-lights-with-tellstick-and-nexa-in-fedora-20/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







</body>
</html>
