<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[blog.fridns.se]]></title>
  <link href="http://blog.fridns.se/atom.xml" rel="self"/>
  <link href="http://blog.fridns.se/"/>
  <updated>2014-02-09T11:28:16+01:00</updated>
  <id>http://blog.fridns.se/</id>
  <author>
    <name><![CDATA[Patrik Martinsson]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Automate your lights with Tellstick and Nexa in Fedora 20]]></title>
    <link href="http://blog.fridns.se/blog/2014/01/12/automate-your-lights-with-tellstick-and-nexa-in-fedora-20/"/>
    <updated>2014-01-12T17:41:08+01:00</updated>
    <id>http://blog.fridns.se/blog/2014/01/12/automate-your-lights-with-tellstick-and-nexa-in-fedora-20</id>
    <content type="html"><![CDATA[<p>In this post I&rsquo;m going to describe the way I have configured my setup to
automate my bedroom-lights. In this particular setup I use the following
components,</p>

<ul>
  <li><a href="http://www.clasohlson.com/se/Inbyggnadsmottagare-universaldimmer-Nexa-WMR-252/36-5271">Nexa WMR252</a>
  <li><a href="http://www.lohelectronics.se/tellstick-p-135.html">Tellstick</a>
  <li><a href="http://www.fedoraproject.org">Fedora</a>
  <li><a href="https://github.com/p3tecracknell/tellprox/">Tellprox</a>
</ul>


<p>The goal of the setup is to automate the lights so that they can be turned
on in the morning, I imagine that if I wake up to a light instead of a buzzer
I will be in a better mood and it will be easier for me to get up. The other
goal is to be able to control the lights from my phone.</p>

<!--more-->


<p>So the first thing is obviously to attach the tellstick to your computer,
after it&rsquo;s been attached look for something like this in your <strong>dmesg</strong>,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>1199357.989893<span class="o">]</span> usb 1-1.1: new full-speed USB device number 12 using ehci-pci
</span><span class='line'><span class="o">[</span>1199358.081310<span class="o">]</span> usb 1-1.1: New USB device found, <span class="nv">idVendor</span><span class="o">=</span>1781, <span class="nv">idProduct</span><span class="o">=</span>0c30
</span><span class='line'><span class="o">[</span>1199358.081313<span class="o">]</span> usb 1-1.1: New USB device strings: <span class="nv">Mfr</span><span class="o">=</span>1, <span class="nv">Product</span><span class="o">=</span>2, <span class="nv">SerialNumber</span><span class="o">=</span>3
</span><span class='line'><span class="o">[</span>1199358.081314<span class="o">]</span> usb 1-1.1: Product: TellStick
</span><span class='line'><span class="o">[</span>1199358.081316<span class="o">]</span> usb 1-1.1: Manufacturer: Telldus
</span><span class='line'><span class="o">[</span>1199358.081317<span class="o">]</span> usb 1-1.1: SerialNumber: A7029QUB
</span><span class='line'><span class="o">[</span>1199358.128916<span class="o">]</span> usbcore: registered new interface driver ftdi_sio
</span><span class='line'><span class="o">[</span>1199358.128926<span class="o">]</span> usbserial: USB Serial support registered <span class="k">for </span>FTDI USB Serial Device
</span><span class='line'><span class="o">[</span>1199358.128991<span class="o">]</span> ftdi_sio 1-1.1:1.0: FTDI USB Serial Device converter detected
</span><span class='line'><span class="o">[</span>1199358.129009<span class="o">]</span> usb 1-1.1: Detected FT232RL
</span><span class='line'><span class="o">[</span>1199358.129010<span class="o">]</span> usb 1-1.1: Number of endpoints 2
</span><span class='line'><span class="o">[</span>1199358.129012<span class="o">]</span> usb 1-1.1: Endpoint 1 MaxPacketSize 64
</span><span class='line'><span class="o">[</span>1199358.129013<span class="o">]</span> usb 1-1.1: Endpoint 2 MaxPacketSize 64
</span><span class='line'><span class="o">[</span>1199358.129014<span class="o">]</span> usb 1-1.1: Setting MaxPacketSize 64
</span><span class='line'><span class="o">[</span>1199358.129427<span class="o">]</span> usb 1-1.1: FTDI USB Serial Device converter now attached to ttyUSB0
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s basically the kernel telling you that it has found the device you just inserted
and attached it to <strong>/dev/ttyUSB0</strong>. If you don&rsquo;t see this in your log,
then you have issues that&rsquo;s beyond the scope of this article, sorry ;)</p>

<p>Assuming that the device actually was found, we continue with downloading, building and
installing the telldus-core,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Make sure you have necessary tools/libs, </span>
</span><span class='line'>sudo yum groupinstall <span class="s2">&quot;Development Tools&quot;</span> <span class="s2">&quot;C Development Tools and Libraries&quot;</span>
</span><span class='line'>sudo yum install libconfuse-devel libftdi-devel cmake
</span><span class='line'>
</span><span class='line'><span class="c"># Download telldus-core, </span>
</span><span class='line'><span class="nb">cd</span> /tmp/
</span><span class='line'>wget http://download.telldus.se/TellStick/Software/telldus-core/telldus-core-2.1.1.tar.gz
</span><span class='line'>tar xvfp telldus-core-2.1.1.tar.gz
</span><span class='line'><span class="nb">cd </span>telldus-core-2.1.1/
</span><span class='line'>
</span><span class='line'><span class="c"># Patch Socket.h since it needs to include unistd.h,</span>
</span><span class='line'>sed -i <span class="s1">&#39;/#include &lt;string&gt;/a \#include &lt;unistd.h&gt;&#39;</span> common/Socket.h
</span><span class='line'>
</span><span class='line'><span class="c"># Build it and install the telldus-core, </span>
</span><span class='line'>cmake
</span><span class='line'>make
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>If you get any errors above while build the telldus-core, you should be able to find
the culprit by looking at the error-message, hopefully it will make some sense (or not,
you never know, however I&rsquo;ve done these exact steps on a clean install of Fedora 20 so
it would surprise me if it failed for you if you&rsquo;re in the same environment).</p>

<p>Since telldus puts its beloved libtelldus-core.so.2 under /usr/local/lib (even though it&rsquo;s
64bit in my case), you have some options</p>

<ul>
  <li> Make ldconfig pick up libs under /usr/local/lib by creating a usr-local.conf under 
  /etc/ld.so.conf.d/ with the path /usr/local/lib in it (or even better, move the libs to 
  /usr/local/lib64 and include that path instead, since it&#8217;s a 64bit system). 
  <li> Make a symbolic in /usr/lib64 that points to /usr/local/lib/libtelldus-core.so.2.1.1
</ul>


<p>Personally I took the easy way out by creating a symlink,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Create a link, </span>
</span><span class='line'>sudo ln -s /usr/lib64/libtelldus-core.so.2 /usr/local/lib/libtelldus-core.so.2.1.1
</span><span class='line'>
</span><span class='line'><span class="c"># Whichever method you prefer, make sure the lib is available, you can check it with </span>
</span><span class='line'>ldd /usr/local/bin/tdtool
</span><span class='line'>
</span><span class='line'>&gt; linux-vdso.so.1 <span class="o">=</span>&gt;  <span class="o">(</span>0x00007fffb63fe000<span class="o">)</span>
</span><span class='line'>&gt; libtelldus-core.so.2 <span class="o">=</span>&gt; /lib64/libtelldus-core.so.2 <span class="o">(</span>0x00007fd9482c2000<span class="o">)</span>
</span><span class='line'>&gt; libstdc++.so.6 <span class="o">=</span>&gt; /lib64/libstdc++.so.6 <span class="o">(</span>0x00007fd947fba000<span class="o">)</span>
</span><span class='line'>&gt; libm.so.6 <span class="o">=</span>&gt; /lib64/libm.so.6 <span class="o">(</span>0x00007fd947cb2000<span class="o">)</span>
</span><span class='line'>&gt; etc..
</span><span class='line'>
</span><span class='line'><span class="c"># If the line that says &quot;libtelldus-core.so.2&quot; does say &quot;Not found&quot;, you are doing something</span>
</span><span class='line'><span class="c"># wrong. Try again (you need to run sudo ldconfig, if you&#39;re choosing the first method).</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Go on with configuring the telldus-core so we can connect it to our <b>Nexa-WMR-252</b>,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Edit the config-file with your favorite editor, </span>
</span><span class='line'>sudo gvim /etc/tellstick.conf
</span><span class='line'>
</span><span class='line'><span class="c"># My config looks like this, but of course this could differ depending on your setup, </span>
</span><span class='line'><span class="c"># --- Start --- </span>
</span><span class='line'><span class="nv">user</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span>
</span><span class='line'><span class="nv">group</span> <span class="o">=</span> <span class="s2">&quot;plugdev&quot;</span>
</span><span class='line'><span class="nv">ignoreControllerConfirmation</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
</span><span class='line'><span class="nv">deviceNode</span> <span class="o">=</span> <span class="s2">&quot;/dev/ttyUSB0&quot;</span>
</span><span class='line'>device <span class="o">{</span>
</span><span class='line'>  <span class="nv">id</span> <span class="o">=</span> 1
</span><span class='line'>    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;Dimmer bedroom&quot;</span>
</span><span class='line'>    <span class="nv">protocol</span> <span class="o">=</span> <span class="s2">&quot;arctech&quot;</span>
</span><span class='line'>    <span class="nv">model</span> <span class="o">=</span> <span class="s2">&quot;selflearning-dimmer&quot;</span>
</span><span class='line'>    parameters <span class="o">{</span>
</span><span class='line'>      <span class="nv">house</span> <span class="o">=</span> <span class="s2">&quot;123456&quot;</span> <span class="c"># This is the code that the nexa-reciever will learn, </span>
</span><span class='line'>      <span class="nv">unit</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c"># --- End --- </span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now, it&rsquo;s time to get the things going,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># First step is to start the telldus-core-daemon, </span>
</span><span class='line'>sudo telldusd
</span></code></pre></td></tr></table></div></figure>


<p>Next step is to learn the nexa our &ldquo;code&rdquo;, press the little button under the
red-diode to put the Nexa-WMR-252 in &ldquo;self-learning-mode&rdquo;, then type the command below, <br><br>
<strong>Notes,</strong></p>

<ul>
  <li>The lights must be off when doing this. 
  <li>The &#8220;self-learning-mode&#8221; lasts for 12 seconds, that means you have to continue with 
      the &#8220;learning-step&#8221; (tdtool &#8211;learn 1) <strong>before</strong> the 12 seconds runs out. The red 
      diode will blink as long as the nexa is in the &#8220;self-learning-mode&#8221;. Once it receives
      the code it will dim on and off the lights. 
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># First, make sure that you have your devices configured properly, </span>
</span><span class='line'>tdtool -l
</span><span class='line'>&gt; Number of devices: 1
</span><span class='line'>&gt; 1    Dimmer bedroom  OFF
</span><span class='line'>
</span><span class='line'><span class="c"># If no devices are listed above, go back and make sure that telldusd is started </span>
</span><span class='line'><span class="c"># correctly, you can get some debug from the daemon by appending the --nodaemon-flag</span>
</span><span class='line'><span class="c"># to it. </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Use the tdtool to learn the nexadevice the code, </span>
</span><span class='line'>tdtool --learn 1
</span><span class='line'>&gt; Learning device: 1 Dimmer bedroom - Success
</span></code></pre></td></tr></table></div></figure>


<p>Awesomeness, now we can do all sorts of fun stuff,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Turn the dimmers on, </span>
</span><span class='line'>tdtool --on 1
</span><span class='line'>&gt; Turning on device 1, Dimmer bedroom - Success
</span><span class='line'>
</span><span class='line'><span class="c"># Turn the dimmers off, </span>
</span><span class='line'>tdtool --off 1
</span><span class='line'>&gt; Turning on device 1, Dimmer bedroom - Success
</span><span class='line'>
</span><span class='line'><span class="c"># Set a specific dim-level, </span>
</span><span class='line'>tdtool --dimlevel 25 --dim 1
</span><span class='line'>
</span><span class='line'><span class="c"># Why not go all the way, </span>
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>seq 10 10 250<span class="k">)</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>tdtool --dimlevel <span class="nv">$i</span> --dim 1
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>seq 250 -10 10<span class="k">)</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>tdtool --dimlevel <span class="nv">$i</span> --dim 1
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>To control my lights through my phone I use the tellprox, found <a href="https://github.com/p3tecracknell/tellprox">here</a>.
This is a local server that you can use if you don&rsquo;t want to use the
&ldquo;tellstick-live-cloud&rdquo;-thingie, which fits me perfect.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Make sure you have git installed, </span>
</span><span class='line'>sudo yum install git
</span><span class='line'>
</span><span class='line'><span class="c"># Clone the tellprox-repo, </span>
</span><span class='line'><span class="nb">cd</span> ~/bin/
</span><span class='line'>git clone https://github.com/p3tecracknell/tellprox
</span><span class='line'>
</span><span class='line'><span class="c"># Edit the configuration for our needs,</span>
</span><span class='line'>gvim config.ini
</span><span class='line'>
</span><span class='line'><span class="c"># My config looks like this, </span>
</span><span class='line'><span class="c"># --- Start --- </span>
</span><span class='line'><span class="nv">host</span> <span class="o">=</span> localhost
</span><span class='line'><span class="nv">port</span> <span class="o">=</span> 8081
</span><span class='line'><span class="nv">debug</span> <span class="o">=</span> False
</span><span class='line'><span class="nv">editable</span> <span class="o">=</span> False
</span><span class='line'><span class="nv">client_name</span> <span class="o">=</span> TellProx
</span><span class='line'><span class="nv">client_id</span> <span class="o">=</span> 1
</span><span class='line'><span class="nv">pretty_print</span> <span class="o">=</span> False
</span><span class='line'><span class="nv">timezone</span> <span class="o">=</span> Europe/London
</span><span class='line'><span class="nv">latitude</span> <span class="o">=</span> 51.4500007629
</span><span class='line'><span class="nv">longitude</span> <span class="o">=</span> -2.58330011368
</span><span class='line'><span class="nv">tzoffset</span> <span class="o">=</span> 3600
</span><span class='line'><span class="nv">webroot</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="nv">username</span> <span class="o">=</span>
</span><span class='line'><span class="nv">password</span> <span class="o">=</span>
</span><span class='line'><span class="nv">apikey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">[</span>sensors<span class="o">]</span>
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Save the config above and start the tellprox, </span>
</span><span class='line'>python -m tellprox
</span><span class='line'>
</span><span class='line'>&gt; Bottle v0.11.6 server starting up <span class="o">(</span>using CherryPyServer<span class="o">())</span>...
</span><span class='line'>&gt; Listening on http://localhost:8081/
</span><span class='line'>&gt; Hit Ctrl-C to quit.
</span><span class='line'>
</span><span class='line'><span class="c"># Note, config.ini should be in the directory from where you are starting tellprox, </span>
</span></code></pre></td></tr></table></div></figure>


<p>Open up a web browser and point it to <a href="http://localhost:8081">http://localhost:8081</a> and you should
see the &ldquo;Dimmer bedroom&rdquo;-device there.</p>

<p>Lastly I want to be able to control this from my phone, and since I don&rsquo;t
have a &ldquo;local network&rdquo; at home, I need to be able to reach it from the &ldquo;internet&rdquo;.
Since there is no basic authentication implemented yet in tellprox (or at least
I can&rsquo;t seem to get it to work, I&rsquo;ll use an apache instance with basic auth infront
of tellprox).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Install apache, </span>
</span><span class='line'>sudo yum install httpd
</span><span class='line'>
</span><span class='line'><span class="c"># Enable it, </span>
</span><span class='line'>sudo systemctl <span class="nb">enable </span>httpd
</span><span class='line'>
</span><span class='line'><span class="c"># Configure it, </span>
</span><span class='line'>sudo gvim /etc/httpd/conf.d/tellprox.conf
</span><span class='line'>
</span><span class='line'><span class="c"># My config looks like this, since we are sending passwords you should be using </span>
</span><span class='line'><span class="c"># ssl (there are tons of guides on how to generate your own self-signed-certificate), </span>
</span><span class='line'>
</span><span class='line'><span class="c"># --- Start ---</span>
</span><span class='line'>Listen xxxx.xx.xx:8082
</span><span class='line'>&lt;VirtualHost *:8082&gt;
</span><span class='line'>  SSLEngine on
</span><span class='line'>  SSLProxyEngine On
</span><span class='line'>  SSLCertificateFile  /path-your-certificate
</span><span class='line'>  SSLCertificateKeyFile /path-to-your-key
</span><span class='line'>  SSLProxyCheckPeerName off
</span><span class='line'>  SSLProxyCheckPeerCN off
</span><span class='line'>
</span><span class='line'>  &lt;Location /&gt;
</span><span class='line'>    AuthType Basic
</span><span class='line'>    AuthName <span class="s2">&quot;You&#39;re not controlling my bedroom-lights!&quot;</span>
</span><span class='line'>    AuthUserFile /etc/httpd/conf.d/passwords
</span><span class='line'>    Require user xxx
</span><span class='line'>  &lt;/Location&gt;
</span><span class='line'>
</span><span class='line'>  <span class="c"># Proxy to tellprox, </span>
</span><span class='line'>  ProxyPass / http://localhost:8081/
</span><span class='line'>  ProxyPassReverse / http://localhost:8081/
</span><span class='line'>
</span><span class='line'>  <span class="c"># Possible values include: debug, info, notice, warn, error, crit, alert, emerg.</span>
</span><span class='line'>  LogLevel info
</span><span class='line'>  ErrorLog /var/log/httpd/tellprox-error.log
</span><span class='line'>  CustomLog /var/log/httpd/tellprox-access.log combined
</span><span class='line'>&lt;/VirtualHost&gt;
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create a password for myuser, </span>
</span><span class='line'>sudo htpasswd -c /etc/httpd/conf.d/passwords myuser
</span><span class='line'>
</span><span class='line'><span class="c"># To allow us to use port 8082 we need </span>
</span><span class='line'><span class="c"># Since the port 8082 isn&#39;t a pre-configured port for a webserver, we need to manually</span>
</span><span class='line'><span class="c"># add with semanage, otherwise selinux will prevent us from listening on that particular </span>
</span><span class='line'><span class="c"># port,  </span>
</span><span class='line'>sudo semanage port -a -t http_port_t -p tcp 8082
</span><span class='line'>
</span><span class='line'><span class="c"># Start the webserver, </span>
</span><span class='line'>sudo systemctl start httpd
</span></code></pre></td></tr></table></div></figure>


<p>Lastly, we make sure that this will keep working after a reboot, and we also set up a
small crontab-job for making the lights turn on in the morning,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Since I&#39;m quite lazy, I choose the rc.local-way of starting things at boot, </span>
</span><span class='line'><span class="c"># but yes, I know, there are &quot;better&quot; (define better) ways of doing this. </span>
</span><span class='line'><span class="c"># But again, this is simple and doesn&#39;t require much, </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Enable rc.local at boot, </span>
</span><span class='line'>sudo systemctl <span class="nb">enable </span>rc-local.service
</span><span class='line'>
</span><span class='line'><span class="c"># Create a /etc/rc.d/rc.local, </span>
</span><span class='line'>sudo gvim /etc/rc.d/rc.local
</span><span class='line'>
</span><span class='line'><span class="c"># --- Start ---</span>
</span><span class='line'><span class="c">#!/bin/bash </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Start the telldus-core-daemon, </span>
</span><span class='line'>/usr/local/sbin/telldusd
</span><span class='line'>
</span><span class='line'><span class="c"># Start our tellprox, maybe not the most beutiful you have seen, bit it works for me, for now, </span>
</span><span class='line'>sudo -u myuser bash -c <span class="s2">&quot;cd /home/myuser/bin/tellprox &amp;&amp; python -m tellprox&quot;</span> &amp;
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Then make a small script, </span>
</span><span class='line'>gvim ~/bin/turnonbedroomlights.sh
</span><span class='line'>
</span><span class='line'><span class="c"># --- Start ---</span>
</span><span class='line'><span class="c">#!/bin/bash </span>
</span><span class='line'>
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>seq 10 10 250<span class="k">)</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>tdtool --dimlevel <span class="nv">$i</span> --dim 1
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="c"># --- End --- </span>
</span><span class='line'>
</span><span class='line'><span class="c"># Make it executable, </span>
</span><span class='line'>chmod +x ~/bin/turnonbedroomlights.sh
</span><span class='line'>
</span><span class='line'><span class="c"># Add a crontab-entry making the lights go on every morning at 6:30, </span>
</span><span class='line'>crontab -e
</span><span class='line'>
</span><span class='line'><span class="c"># Every weekday morning, </span>
</span><span class='line'>30 06 * * 1-5 /home/username/bin/turnonbedroomlights.sh
</span></code></pre></td></tr></table></div></figure>


<p>And there you have it, enjoy !<br></p>

<ul>
  <li> Automatically turn on my lights in the morning. 
  <li> Control them from my phone 
</ul>


<p>Comments, suggestions and questions are welcome!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[smplayer subtitles errror]]></title>
    <link href="http://blog.fridns.se/blog/2011/08/08/smplayer-subtitles-errror/"/>
    <updated>2011-08-08T23:44:14+02:00</updated>
    <id>http://blog.fridns.se/blog/2011/08/08/smplayer-subtitles-errror</id>
    <content type="html"><![CDATA[<p>Lately (or actually since way back, I&rsquo;ve just started to notice it a bit more nowdays) I&rsquo;ve been getting this annoying error when downloading subtitles from <a href="http://opensubtitles.org">opensubtitles.org</a>, smplayer finds the subtitle and starts to download it, but fails at random points during the download and throws the error &ldquo;failed to download subtitle&rdquo;. Today I set out to fix this annoying problem &ndash; however, it didn&rsquo;t take me long to find out that there actually was a bugreport on this, <b>and</b> that the bug also been fixed in later svn-revisions.
<del>I checked out the latest source (3614 as of writing) and built the packages for Ubuntu 10.04/11.04, feel free to grab them them <a href="http://blog.fridns.se/wp-content/uploads/2011/08/smplayer_0.6.9-SVN-r3614_amd64.deb">here</a> (10.04) and <a href="http://blog.fridns.se/wp-content/uploads/2011/08/smplayer_0.6.9-SVN-r3614_11.04_amd64.deb">here</a>(11.04).
Once downloaded, just install them with dpkg,
</del></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spotify in Red Hat 6]]></title>
    <link href="http://blog.fridns.se/blog/2011/06/30/spotify-in-red-hat-6/"/>
    <updated>2011-06-30T21:10:35+02:00</updated>
    <id>http://blog.fridns.se/blog/2011/06/30/spotify-in-red-hat-6</id>
    <content type="html"><![CDATA[<p><del>
I&rsquo;ve packaged (and will probably make newer packages as newer builds arrive) the Spotify client for Red Hat Enterprise Linux 6. There is probably not a lot of &ldquo;private users&rdquo; using Rhel 6 Desktop, since it&rsquo;s more a corporate distribution, <b>but hey !</b> working people also want Spotify ;) The package should probably work on Fedora as well, however I leave no guarantees, if it doesn&rsquo;t, feel free to rebuild it. You can grab the spec-file <a href="http://blog.fridns.se/wp-content/uploads/2011/06/spotify.spec">here</a>. The package is built with Gnome-support and should integrate nicely with menus and Spotify url&rsquo;s.
<a id="more"></a><a id="more-235"></a></del></p>

<p><b>Edit 20140107, </b><br>
* There is a better way nowdays, use the &ldquo;old method&rdquo; (the new method is only working in fedora atm) described <a href=http://community.spotify.com/t5/Help-Desktop-Linux-Mac-and/Linux-Fedora-RPM-package-for-F17-F19/m-p/237688#M8446>here</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Disable sound in gdm - Ubuntu 11.04]]></title>
    <link href="http://blog.fridns.se/blog/2011/06/27/disable-sound-in-gdm-ubuntu-11-04/"/>
    <updated>2011-06-27T08:42:51+02:00</updated>
    <id>http://blog.fridns.se/blog/2011/06/27/disable-sound-in-gdm-ubuntu-11-04</id>
    <content type="html"><![CDATA[<p>There is a very annoying sound (a drumroll) at the login of Ubuntu 11.04 (I think it applies to earlier version to, although this method of disabling it does not, it should however work on Fedora 15). There is a gui (System/Administration/Login Screen) for making this happen, although it seems rather broken (read about it <a href=http://askubuntu.com/questions/24946/how-do-i-disable-the-drum-beat-sound-on-the-login-screen>here</a>). Nowadays dconf (gsettings is the api) is used as backend rather then gconf, although not all applications has adapted this, gdm has.
<a id="more"></a><a id="more-233"></a></p>

<!--more-->


<p>So what it boils down to is basically &ldquo;set the right gsettings for the gdm-user (since gdm is started by the user gdm)&rdquo;. Here&rsquo;s how,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Become root in whatever way you want, &lt;br&gt;</span>
</span><span class='line'>su -
</span><span class='line'>
</span><span class='line'><span class="c"># Start a shell as the gdm-user, </span>
</span><span class='line'>su - gdm -s /bin/bash
</span><span class='line'>
</span><span class='line'><span class="c"># Start a session-bus,</span>
</span><span class='line'><span class="nb">eval</span> <span class="k">$(</span>dbus-launch --sh-syntax<span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Set the right settings through gsettings, </span>
</span><span class='line'>gsettings <span class="nb">set </span>org.gnome.desktop.sound event-sounds <span class="nb">false</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Logout, </span>
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thanks to Norman Smith that&rsquo;s mentioning the above solution in this <a href=https://bugzilla.redhat.com/show_bug.cgi?id=503360#c30>bugzilla</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu Classic - Flash fullscreen]]></title>
    <link href="http://blog.fridns.se/blog/2011/06/21/ubuntu-classic-flash-fullscreen/"/>
    <updated>2011-06-21T23:17:36+02:00</updated>
    <id>http://blog.fridns.se/blog/2011/06/21/ubuntu-classic-flash-fullscreen</id>
    <content type="html"><![CDATA[<p>If you&rsquo;re using the &ldquo;Ubuntu Classic (No effects)&rdquo;-mode in the latest Ubuntu (11.04 as of writing) there is an annoying problem with playing fullscreen flash &ndash; <strong>it doesn&rsquo;t work.</strong> The picture will either freeze or get black, sound is still playing though, but there is <b>no way</b> you will get any fullscreen.</p>

<!--more-->


<p>It took me a couple of hours to find it, but the solution, once you know it, is quite simple &ndash; just enable &ldquo;legacy fullscreen&rdquo; in compiz.</p>

<p>Simply install the &#8221;compizconfig-settings-manager&#8221;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install compizconfig-settings-manager
</span></code></pre></td></tr></table></div></figure>


<p>Launch it, either by a terminal (/usr/bin/ccsm) or by,
System <strong>=&gt;</strong> Preferences <strong>=&gt;</strong> &ldquo;CompizConfig Settings Manager&rdquo;</p>

<p>Once in the application,
Click on Utility <strong>=&gt;</strong> Workarounds <strong>=&gt;</strong> Check the &ldquo;Legacy Fullscreen Support&rdquo; option.</p>

<p>Close &ldquo;CompizConfig Settings Manager&rdquo;,
<b>=></b> log out,
<b>=></b> log back in,
and you <strong>should</strong> be able to watch flash in fullscreen.</p>

<p><strong>Sidenote,</strong><br>
Depending on which backend you use (normally gconf) the settings are stored as follows,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># gconf, </span>
</span><span class='line'><span class="nv">$HOME</span>/.gconf/apps/compizconfig-1/profiles/Default/plugins/workarounds/screen0/options/%gconf.xml
</span><span class='line'>
</span><span class='line'><span class="c"># ini, </span>
</span><span class='line'><span class="nv">$HOME</span>/.config/compiz-1/compizconfig/Default.ini&lt;/blockquote&gt;
</span></code></pre></td></tr></table></div></figure>


<p><b>Update, 20110624</b><br>
After playing with flash some more I find that this solution is not fully working. In fact the solution suggested above is incorrect (I have no idea why I thought it worked the first time &ndash; the problem seems to be random and flash just happened to worked when I activated &ldquo;Legace fullscreen support&rdquo;),  because when using &ldquo;Ubuntu Classic (no effects) you&rsquo;re not using compiz at all (which makes sense when you think about it) which in turns would make the compiz-options useless (read, since compiz is not used, the settings aren&rsquo;t either). <b>At least</b> that&rsquo;s how I think it is, if anyone have any better explanation, please share it in the comments below.</p>

<p>After hours of fiddling with this I finally gave up, I thought I would give Ubunbu Classic a shot (using compiz that is) and flash actually now worked as expected (I tried with/without the &ldquo;Legacy fullscreen support&rdquo;, but I didn&rsquo;t noticed any differences so I decided to just leave the option on). The reason in the first place why I didn&rsquo;t want compiz and all the effects is because I think it clutters up my desktop, but with compizconfig-settings-manager you&rsquo;re able to disable most of them, so for now compiz is enabled &ndash; only so I can watch flash in fullscreen on various sites.</p>

<p><b>Worth mentioning,</b><br></p>

<ul>
<li>When using Ubuntu Classic (No effects) I could get fullscreen to work <b>if</b> the browserwindow was not maximized. The video would then go fullscreen in the background (that is, behind the browserwindow) and as soon as I moved the mouse from the browserwindow to the fullscreen I would get a working fullscreen. However this is not a working solution for me.<br></li>
<li>For some reason, now when I&rsquo;m playing with compizconfig-settings-manager the settings seem to be stored in <br></li>
</ul>


<p>$HOME/.gconf/apps/compiz-1/plugins/workarounds/screen0/options/%gconf.xml<br>
instead of as I earlier thought <br>
$HOME/.gconf/apps/compizconfig-1/profiles/Default/plugins/workarounds/screen0/options/%gconf.xml<br>
Not really surewhats going on here though.</p>

<p><b>Finally,</b><br>
If you could get the sites below show flash in fullscreen with<br>
&ndash; Ubuntu 11.04 in Classic Mode (No Effects),<br>
&ndash; Google Chrome, <br>
&ndash; Native 64 Flash plugin (square) <br>
&ndash; on an ION2-based platform, <br>
please tell me how you did it. <br></p>

<p><a href=http://www.break.com/>&ndash; <a href="http://www.break.com">http://www.break.com</a></a><br>
<a href=http://www.imdb.com/>&ndash; <a href="http://www.imdb.com">http://www.imdb.com</a></a><br>
<a href=http://www.dump.com/>&ndash; <a href="http://www.dump.com">http://www.dump.com</a></a><br>
<a href=http://www.youtube.com/>&ndash; <a href="http://www.youtube.com">http://www.youtube.com</a></a><br>
<a href=http://www.ted.com/>&ndash; <a href="http://www.ted.com">http://www.ted.com</a></a><br>
<a href=http://www.wimp.com/>&ndash; <a href="http://www.wimp.com">http://www.wimp.com</a></a><br>
<a href=http://www.sf.se/>&ndash; <a href="http://www.sf.se/">http://www.sf.se/</a></a><br></p>

<p><b>Update, 20110625</b><br>
Disabling &ldquo;Legacy fullscreen support&rdquo; since it seems to break xbmc&rsquo;s &ldquo;quick fullscreen switching&rdquo; (<b>alt+backslash</b>).
<b>This is ridiculous. </b></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spotify Linux - Now with PulseAudio support. ]]></title>
    <link href="http://blog.fridns.se/blog/2011/06/19/spotify-linux-now-with-pulseaudio-support/"/>
    <updated>2011-06-19T19:32:36+02:00</updated>
    <id>http://blog.fridns.se/blog/2011/06/19/spotify-linux-now-with-pulseaudio-support</id>
    <content type="html"><![CDATA[<p>If you&rsquo;re a Linux user and a paying customer to the great <a href="http://www.spotify.com/se/">Spotify-service</a> you nowdays have a native <a href="http://www.spotify.com/se/download/previews/">functional client</a>,</p>

<ul>
<li>With PulseAudio Support</li>
<li>With incicator-sound integration</li>
<li>All the other regular functions you would excpect out of a client.</li>
</ul>


<p>Although this client works pretty much out of the box, there are some things that you may have to do by hand.</p>

<!--more-->


<p><b>1)</b> Since Spotify has been linked to to <b>/usr/lib/libpulse.so.0</b> you must make sure that this file is in place, otherwise Spotify will use ALSA and you wont get a functional volume-control.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo ln -s /usr/lib/libpulse.so.0 /usr/lib/libpulse.so
</span></code></pre></td></tr></table></div></figure>


<p><b>2)</b> To get the album-art in the indicator-sound-applet you must make sure that you have <b>$HOME/.cache/indicators/sound/</b> in place, otherwise the applet wont be able to create a tmp-folder for its album-art. I&rsquo;ve filed a bug on this matter, you can read about it <a href="https://bugs.launchpad.net/indicator-sound/+bug/799383">here</a>. Basically the creation of the folder is done without making sure the folders parents are in place (eg. mkdir /tmp/foo/bar instead of mkdir -p /tmp/foo/bar, the first method is fine if you <b><em>can be sure</em></b> that /tmp/foo will be there, the -p flag will create /tmp/foo first if missing).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir <span class="nv">$HOME</span>/.cache/indicators/sound/album-art-cache
</span></code></pre></td></tr></table></div></figure>


<p>Spotify ftw.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Free Cache - drop_caches as nonroot]]></title>
    <link href="http://blog.fridns.se/blog/2011/04/22/drop_caches-as-nonroot/"/>
    <updated>2011-04-22T08:38:49+02:00</updated>
    <id>http://blog.fridns.se/blog/2011/04/22/drop_caches-as-nonroot</id>
    <content type="html"><![CDATA[<p>The other day I got a request from a developer at our company regarding drop_caches. You can read about what it is and why it could be useful <a href="http://linux-mm.org/Drop_Caches">here</a>, but to make it short, this person wanted to do some benchmarking and needed the page/inode/dentry cache to be freed. Since this is needed to be done by root, this caused a problem (developer is not root, our infrastructure setup doesn&rsquo;t allow our developers to be root atm). Although I came up with a pretty neet sudo rule that does the job,
<a id="more"></a><a id="more-142"></a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/sbin/sysctl -w vm.drop_caches<span class="o">=[</span>1-3<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Just put the above command in <b>/etc/sudoers</b> for affected users and they should be able to free page/inode/dentry cache as they wish.</p>

<p>Keep it simple.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fedora 14 – Flashplayer weird sound issue]]></title>
    <link href="http://blog.fridns.se/blog/2011/01/21/fedora-14-flashplayer-weird-sound-issue/"/>
    <updated>2011-01-21T02:48:20+01:00</updated>
    <id>http://blog.fridns.se/blog/2011/01/21/fedora-14-flashplayer-weird-sound-issue</id>
    <content type="html"><![CDATA[<p>There is a really annoying problem with the flashplayer in Fedora 14 when it comes to playing flashvideos with mp3&rsquo;s in them. You will hear this kind of clipping/high pitched sound which is really unbearable. Luckily there is a quite easy solution, download <a href="https://bugzilla.redhat.com/attachment.cgi?id=460254">this script</a> (Ray Strode, Red Hat) and apply it to your libflashplayer.so, <!--more-->something like</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget https://bugzilla.redhat.com/attachment.cgi?id<span class="o">=</span>460254 -O libflashplayerpatch.sh
</span><span class='line'>sudo sh libflashplayerpatch.sh  /usr/lib64/flash-plugin/libflashplayer.so
</span><span class='line'>sudo chmod 644 /usr/lib64/flash-plugin/libflashplayer.so
</span></code></pre></td></tr></table></div></figure>


<p>will do the trick. It may take a couple of minutes to finish depending on your computer. While the script is running you will se alot of lines like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Changing call at offset 0x7c1d64 from <span class="o">[</span>60 c1 8f ff<span class="o">]</span> to <span class="o">[</span>50 bf 8f ff<span class="o">]</span>
</span><span class='line'>Changing call at offset 0x7c9b3f from <span class="o">[</span>85 43 8f ff<span class="o">]</span> to <span class="o">[</span>75 41 8f ff<span class="o">]</span>
</span><span class='line'>Changing call at offset 0x7c9b5c from <span class="o">[</span>68 43 8f ff<span class="o">]</span> to <span class="o">[</span>58 41 8f ff<span class="o">]</span>
</span><span class='line'>Changing call at offset 0x7ca0bb from <span class="o">[</span>09 3e 8f ff<span class="o">]</span> to <span class="o">[</span>f9 3b 8f ff<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>I don&rsquo;t know if the chmod 644 line is really neccecary, although on my system the libflashplayer.so got 600 after running the script which means that no one, except root, will be able to use the plugin. Other than that it should be all good.</p>

<p>Enjoy!</p>

<p><strong>For the curious reader : </strong> It&rsquo;s a recent change in memcpy() in glibc that made libflashplayer break. Although the bug was introduced by this change, the actual bug lies in how Adobe implements memcpy(), rather then in glibc. You can read a more detailed explanation <a href="https://bugzilla.redhat.com/show_bug.cgi?id=638477#c31">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Letter to SCM Microsystems #2]]></title>
    <link href="http://blog.fridns.se/blog/2011/01/13/letter-to-scm-microsystems-2/"/>
    <updated>2011-01-13T04:24:03+01:00</updated>
    <id>http://blog.fridns.se/blog/2011/01/13/letter-to-scm-microsystems-2</id>
    <content type="html"><![CDATA[<p>It took a couple of days, but SCM Microsystems did actually answer my <a href="http://blog.fridns.se/?p=5">email</a>, although it was very unsatisfying. It&rsquo;s actually so bad that when you read it you get kind of angry because of their incompetence in this matter.<!--more--></p>

<blockquote><p>Dear Mr. Martinsson,</p><p>The reader that is in the Laptop is an OEM product. You need to contact<br/>HP for further information.</p></blockquote>


<p>So, I wrote them a new mail, explaining that this had nothing to do with HP or any manufacturer for that matter, hoping that someone with some knowledge would answer me.</p>

<blockquote><p>Hello again,</p><p>Thank you for taking your time to answer, even though I find the answer<br/>very short and incomplete.</p><p>Forget my laptop and that it&#8217;s an OEM product, it has nothing to do with<br/>HP (or any vendor for that matter),  what I&#8217;m asking you is to make the<br/>SCR241 driver for Linux available to both 32bit and 64bit-architectures.<br/>You have both architectures for all the Windows-versions, so I don&#8217;t see<br/>any reason why you wouldn&#8217;t have the same for your Linux-driver. It&#8217;s a<br/>fact that people today uses 64 bit Operating Systems, not only on the<br/>Windows side.</p><p>Another note is that the Linuxdriver will only work with kernels <2.35,<br/>because of some changes in the pcmcia structure in the kernel, so I&#8217;m<br/>sure people would appreciate if you updated your driver so it would work<br/>on newer kernels to.</p><p>Don&#8217;t just dismiss my letter and give me a short answer, I would like to<br/>see this happen, even if you do deny the request I would like to see the<br/>discussion behind it.</p><p>Best regards,<br/>Patrik Martinsson,</p></blockquote>


<p>A few days later I got an answer, not the answer I was hoping for, but still a reasonable answer.</p>

<blockquote><p>Dear Mr. Martinsson,</p><p>Sorry for the way your problem has been handled so far.</p><p>Unfortunately, it really is such, that we do not have a driver for 64bit<br/>Linux systems.</p><p>This is mostly due to the fact that the demand for such a driver has<br/>been merely inexistent till today.<br/>The other issue, the one with the kernel version, is sure enough<br/>something we should look into correcting.<br/>I brought this to the attention of development some time ago and they&#8217;re<br/>currently evaluating the resources it would take to update the driver.<br/>As soon as a resource is located, the update will commence. I will put<br/>some more weight on the necessity of having a 64 bit driver in these<br/>days of machines with more than 4GB of RAM.<br/>Once I have some information on estimated time frame and kind of update<br/>from development, I will let you know.</p></blockquote>


<p>I guess that&rsquo;s the end for now.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rhel 6 – Ananonda – ssl enabled repos]]></title>
    <link href="http://blog.fridns.se/blog/2011/01/09/rhel-6-ananonda-ssl-enabled-repos/"/>
    <updated>2011-01-09T13:24:44+01:00</updated>
    <id>http://blog.fridns.se/blog/2011/01/09/rhel-6-ananonda-ssl-enabled-repos</id>
    <content type="html"><![CDATA[<p>So it turns out that the Rhel6 image is missing libnsspem.so (a library used by curl to initialize nss as the ssl-engine) which breaks the ssl-validation in anaconda. This is normally not a problem, however if you for some reason have password-protected repository&rsquo;s and don&rsquo;t feel like sending your password in clear text over the network for every client/server you kickstart-install, this is going to be a problem.</p>

<p>Luckily there is an easy fix for it &ndash; include the necessary library in the Rhel 6 install.img-file.</p>

<!--more-->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mkdir /foo /bar
</span><span class='line'>sudo mount -o loop path-to-rhel6-install.img /foo
</span><span class='line'>sudo cp -r /foo /bar
</span><span class='line'>sudo cp /usr/lib<span class="o">[</span>arch<span class="o">]</span>/libnsspem.so /bar/usr/lib<span class="o">[</span>arch<span class="o">]</span>
</span><span class='line'>sudo mksquashfs /bar install.img
</span></code></pre></td></tr></table></div></figure>


<p>Just replace the original install.img-file from the dvd-source with the one you just created and should be alright. The above steps would be made from an already installed Rhel 6 or atleast on a client with a libnsspem.so-file that is compatible with the version of nss Rhel 6 is running.</p>

<p>You could probably copy the library over in the %pre section of the kickstart-file, but then you would have to figure out a way to either,</p>

<p><b>1)</b> remount /usr/lib[arch] to writable (for placing the libnsspem.so in there), or<br>
<b>2)</b> you would have to add the directory where you placed libnsspem.so to the LD_LIBRARY_PATH and then make anaconda use that.</p>

<p><strong>Note</strong>, <br>This is beeing fixed for Rhel 6.1, see <a title="bugreport" href="https://bugzilla.redhat.com/show_bug.cgi?id=667122">bugreport</a> at Red Hat&rsquo;s bugzilla.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fedora 14 – AR8152 Ethernet Controller]]></title>
    <link href="http://blog.fridns.se/blog/2011/01/02/fedora-14-ar8152-ethernet-controller-2/"/>
    <updated>2011-01-02T18:53:14+01:00</updated>
    <id>http://blog.fridns.se/blog/2011/01/02/fedora-14-ar8152-ethernet-controller-2</id>
    <content type="html"><![CDATA[<p>If you have a Asus 1215n with the AR8152 Ethernet controller chip you may have noticed that it doesn&rsquo;t work right out of the box, although thanks to this <a href="http://rhythmcloud.blogspot.com/2010/07/how-to-install-ar8151-v10-gigabit.html">blog</a> I managed to get it working. You will notice that the instructions from the blog just mentioned are for fedora 13, and unfortunately there are some differences in the kernel between the releases (2.6.32 &ndash; 2.6.35) that will make the compilation of the driver fail. I&rsquo;ve created a small patch that takes care of this issue, but I leave no guarantees, you&rsquo;re on your own if it doesn&rsquo;t work.</p>

<!--more-->


<p>Just follow the steps on the blog until you reach step 6, download my <a href="http://blog.fridns.se/wp-content/uploads/2011/01/experimental.patch">patch</a>, and put it in the directory where driver is extracted is extracted, then apply it with following command,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>patch -p1 &lt; experimental.patch
</span></code></pre></td></tr></table></div></figure>


<p>
I also noticed people were asking questions about how to handle this at kernel upgrades, and if they needed to do it all over again, and the answer is actually no. You should not need to redo all this when your system is upgraded with a new kernel, it used to be like that, but now days there is a cool feature called dkms (dynamic kernel module support) which is suppose to take care of this for you. I&rsquo;m not really that familiar with this since I&rsquo;m used with my stuff working out of the box, but from what I understand you will add a module with the dkms-command, and later when a kernel upgrade is made, the module will automagically be compiled for the new kernel. Since the guys at Atheros were so nice that they prepared the Makefile for this, the only thing you should need to do to get this working is,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo yum install -y dkms
</span><span class='line'>sudo make dkms
</span></code></pre></td></tr></table></div></figure>


<p>and make should take care of it (it seems, at least for me, that the  rpmbuild commands returns a nonzero value when exiting, which usually means there is an error, thus making &lsquo;make&rsquo; thinks it failed, however, the rpm&rsquo;s are there and I think they are just fine, but I&rsquo;ll find that  out at the next kernelupgrade).</p>

<p>For the curious reader, patch will do following,</p>

<ul>
    <li>use the netdev_for_each_mc_addr function to get addresses for the device (as of 2.6.34 this is the way to do it).</li>
    <li>disable the check for which kernel we are running (rather then fixing it).</li>
    <li>change the dkms-command so it builds an rpm instead of a Debian package.</li>
</ul>


<p>Enjoy !</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Letter to SCM Microsystems]]></title>
    <link href="http://blog.fridns.se/blog/2010/12/28/hp-elitebook-internal-smartcard-nightmare/"/>
    <updated>2010-12-28T18:55:36+01:00</updated>
    <id>http://blog.fridns.se/blog/2010/12/28/hp-elitebook-internal-smartcard-nightmare</id>
    <content type="html"><![CDATA[<p>Figure I would share a letter I wrote to the SCM Microsystem regarding their smart card chipsets, that I believe is found in some of the HP EliteBook models (this is not confirmed, but according to a letter written by HP to a customer, it seems that way, <a href="http://ubuntuforums.org/showthread.php?t=1628040">source</a>) .<a id="more"></a><a id="more-5"></a></p>

<blockquote><p>Hello,<br/>My name is Patrik Martinsson and I&#8217;m currently working as a system administrator at a government funded meteorological institute in Sweden.</p><p>We have a lot of &#8220;Linux-desktop-clients&#8221; in our company (around 1/5 of the employees choose Linux, at least to us that a lot ).</p><p>Somewhere around 2009 we started to use smart card on all our clients to authenticate ourselves, this was a bit of a hassle to get working on the Linux side, but we finally got the clients working as we wanted, with one exception, the internal smart card readers just wouldn&#8217;t work (sadly to say, I wasn&#8217;t that surprised). There was no way to get them working, mostly because we couldn&#8217;t identify them, nobody could really, not even HP support when I called them (not the people I spoke to anyway). So we started to buy &#8220;external&#8221; pcmcia card readers for our Linux users, which was an acceptable solution, not preferred in any way, but acceptable.</p><p>Anyway, today a college of mine stumbled over a letter from HP to a customer that indicates that their models (at least one of them, EliteBook 2540p) has the scr241 chip, and that it is possible to use your kernelmodule (with a small modification, adding their, HP, pcmcia_decvice_prod_id, so your module will recognize it, I&#8217;m not a developer, so please correct me if I&#8217;m wrong) on atleast, HP EliteBook 2540p (my guess is that your chip is other HP models too), to get the internal smart card reader to work.</p><p>Sadly to say, you only have this scr241 driver for Linux available for 32-bit architectures, which to me is a shame, and also a bit surprising, since I noticed that you have all the Windows drivers for both 32 and 64-architectures.</p><p>So, what I ask, and what I really really need from you is your, proprietary driver for the scr241 chip, compiled for a 64 bit architecture (libSCR24x.so.4.2.1), I don&#8217;t ask for any support or anything like that on the driver, I just need it to work on 64-bit architectures so I can test whether we can get our internal readers to work.</p><p>Please, I&#8217;m asking you as a developer to help a sysadmin out!</p><p>Best regards,<br/>Patrik Martinsson</p></blockquote>


<p></p>
]]></content>
  </entry>
  
</feed>
